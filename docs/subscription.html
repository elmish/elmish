<html class="has-navbar-fixed-top" lang="en"><head><title>Elmish Â· Subscriptions</title><meta http-equiv="content-type" content="text/html; charset=UTF-8" charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="shortcut icon" href="/elmish/img/logo.png"/><link rel="stylesheet" type="text/css" href="/elmish/style.css"/><script src="https://unpkg.com/scroll-into-view-if-needed@2.2.28/umd/scroll-into-view-if-needed.min.js"></script></head><body class="has-footer"><nav class="navbar is-fixed-top is-spaced"><div class="container"><div class="navbar-brand"><a class="navbar-item title is-4" href="https://elmish.github.io/elmish/">Elmish</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/elmish/docs/basics.html">Docs</a><div class="navbar-item navbar-burger-dots is-hidden-tablet"><svg height="4" stroke="none" viewBox="0 0 22 4" width="22"><circle cx="2" cy="2" r="2"></circle><circle cx="2" cy="2" r="2" transform="translate(9,0)"></circle><circle cx="2" cy="2" r="2" transform="translate(18,0)"></circle></svg></div></div><div class="navbar-end is-hidden-mobile"><a class="navbar-item" href="https://github.com/elmish/elmish"><span class="icon"><i class=" fab fa-2x fa-github fa-lg"></i></span></a></div></div><div class="nacara-navbar-menu"><a class="nacara-navbar-menu-item" href="https://github.com/elmish/elmish">GitHub</a></div></div></nav><div class="grey-overlay"></div><div class="nacara-content"><div class="container"><div class="mobile-menu"><nav class="breadcrumb"><ul><li><a class="menu-trigger"><span></span><span></span><span></span></a></li><li class="is-active"><a>Step by step</a></li><li class="is-active"><a>Subscriptions</a></li></ul></nav></div><div class="columns is-gapless is-mobile"><div class="column is-menu-column is-3-desktop is-hidden-touch"><div class="menu-container"><aside class="menu"><p class="menu-label">Step by step</p><ul class="menu-list"><li><a class=" " href="/elmish/docs/basics.html">Basics</a></li><li><a class=" " href="/elmish/docs/parent-child.html">Parent-child composition</a></li><li><a class=" is-active" href="/elmish/docs/subscription.html">Subscriptions</a></li><li><a class=" " href="/elmish/docs/subscriptionv3.html">Subscriptions (v3)</a></li></ul></aside></div></div><div class="column is-9-desktop is-full-touch"><section class="section"><div class="content"><header class="page-header"><div class="columns is-vcentered"><div class="column"><nav class="breadcrumb is-category-navigation is-hidden-touch"><ul><li class="is-active"><a>Step by step</a></li><li class="is-active"><a>Subscriptions</a></li></ul></nav></div><div class="column is-narrow"><a class="button is-hidden-touch is-ghost" target="_blank" href="https://github.com/elmish/elmish/edit/v4.x/docs/docs/subscription.fsx">Edit</a></div></div><h1 class="title is-1">Subscriptions</h1></header><div><style class=grvsc-styles>.grvsc-container{overflow:auto;position:relative;-webkit-overflow-scrolling:touch;padding-top:1rem;padding-top:var(--grvsc-padding-top,var(--grvsc-padding-v,1rem));padding-bottom:1rem;padding-bottom:var(--grvsc-padding-bottom,var(--grvsc-padding-v,1rem));border-radius:8px;border-radius:var(--grvsc-border-radius,8px);font-feature-settings:normal;line-height:1.4}.grvsc-code{display:table}.grvsc-line{display:table-row;box-sizing:border-box;width:100%;position:relative}.grvsc-line>*{position:relative}.grvsc-gutter-pad{display:table-cell;padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem))/ 2)}.grvsc-gutter{display:table-cell;-webkit-user-select:none;-moz-user-select:none;user-select:none}.grvsc-gutter::before{content:attr(data-content)}.grvsc-source{display:table-cell;padding-left:1.5rem;padding-left:var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem));padding-right:1.5rem;padding-right:var(--grvsc-padding-right,var(--grvsc-padding-h,1.5rem))}.grvsc-source:empty::after{content:' ';-webkit-user-select:none;-moz-user-select:none;user-select:none}.grvsc-gutter+.grvsc-source{padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem))/ 2)}.grvsc-has-line-highlighting>.grvsc-code>.grvsc-line::before{content:' ';position:absolute;width:100%}.grvsc-line-diff-add::before{background-color:var(--grvsc-line-diff-add-background-color,rgba(0,255,60,.2))}.grvsc-line-diff-del::before{background-color:var(--grvsc-line-diff-del-background-color,rgba(255,0,20,.2))}.grvsc-line-number{padding:0 2px;text-align:right;opacity:.7}.atom-one-light{background-color:#fafafa;color:#383a42}.atom-one-light .mtki{font-style:italic}.atom-one-light .mtk14{color:#a626a4}.atom-one-light .mtk1{color:#383a42}.atom-one-light .mtk9{color:#4078f2}.atom-one-light .mtk4{color:#c18401}.atom-one-light .mtk5{color:#e45649}.atom-one-light .mtk6{color:#986801}.atom-one-light .mtk10{color:#50a14f}.atom-one-light .mtk7{color:#a0a1a7}.atom-one-light .mtk8{color:#0184bc}.atom-one-light .grvsc-line-highlighted::before{background-color:var(--grvsc-line-highlighted-background-color,rgba(0,0,0,.05));box-shadow:inset var(--grvsc-line-highlighted-border-width,4px) 0 0 0 var(--grvsc-line-highlighted-border-color,rgba(0,0,0,.2))}</style><blockquote><p>Subscriptions changed in v4. For v3 and earlier subscription, see <a href=./subscriptionv3.html>Subscriptions (v3)</a>. Or see <a href=#migrating-from-v3>Migrating from v3</a> below.</blockquote><h3 id=working-with-external-sources-of-events>Working with external sources of events<a href=#working-with-external-sources-of-events aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><p>Sometimes we have a source of events that runs independently of Elmish, like a timer. We can use subscriptions control when those sources are running, and forward its events to our <code>update</code> function.<p>Let's define our <code>Model</code> and <code>Msg</code> types. <code>Model</code> will hold the current state and <code>Msg</code> will tell us the nature of the change that we need to apply to the current state.<pre class="atom-one-light grvsc-container"data-index=0 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Elmish</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Fable.Core</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>System</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>module</span><span class=mtk9> BasicTimer </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Model</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            current </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>DateTime</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Msg</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Tick </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>DateTime</span></span></span></code></pre><p>Now let's define <code>init</code> and <code>update</code>.<pre class="atom-one-light grvsc-container"data-index=1 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>init</span><span class=mtk1> </span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            current </span><span class=mtk14>=</span><span class=mtk1> DateTime.MinValue</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>},</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>update</span><span class=mtk1> msg model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>match</span><span class=mtk1> msg </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Tick current </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span><span class=mtk1> model </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                current </span><span class=mtk14>=</span><span class=mtk1> current</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>},</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span></code></pre><p>Now lets define our timer subscription:<pre class="atom-one-light grvsc-container"data-index=2 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>timer</span><span class=mtk1> onTick </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>start</span><span class=mtk1> dispatch </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>intervalId</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                JS.setInterval</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span><span class=mtk1> dispatch </span><span class=mtk14>(</span><span class=mtk1>onTick DateTime.Now</span><span class=mtk14>))</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    </span><span class=mtk6>1000</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span><span class=mtk1> </span><span class=mtk14>new</span><span class=mtk1> IDisposable </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>member</span><span class=mtk1> </span><span class=mtk5>_.Dispose</span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> JS.clearInterval intervalId </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        start</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>subscribe</span><span class=mtk1> model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>[</span><span class=mtk1> </span><span class=mtk14>[</span><span class=mtk10>"timer"</span><span class=mtk14>],</span><span class=mtk1> timer Tick </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    Program.mkProgram init update </span><span class=mtk14>(fun</span><span class=mtk1> model _ </span><span class=mtk14>-></span><span class=mtk1> printf </span><span class=mtk10>"</span><span class=mtk14>%A</span><span class=mtk6>\n</span><span class=mtk10>"</span><span class=mtk1> model</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|></span><span class=mtk1> Program.withSubscription subscribe</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|></span><span class=mtk1> Program.run</span></span></span></code></pre><p><code>subscribe</code> answers the question: "Which subscriptions should be running?" <code>subscribe</code> is provided the current program state, <code>model</code>, to use for decisions. When the model changes, <code>subscribe</code> is called. Elmish then starts or stops subscriptions to match what is returned.<p>A subscription has an ID, <code>["timer"]</code> here, and a start function. The ID needs to be unique within that page.<blockquote><p><strong>ID is a list?</strong><p>This allows us to include dependencies. Later we will use this to change the timer's interval.</blockquote><h3 id=conditional-subscriptions>Conditional subscriptions<a href=#conditional-subscriptions aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><p>In the above example, the timer subscription is always returned from <code>subscribe</code>, so it will stay running as long as the program is running. Let's look at an example where the timer can be turned off.<p>First we add the field <code>enabled</code> and a msg <code>Toggle</code> to change it.<pre class="atom-one-light grvsc-container"data-index=3 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>module</span><span class=mtk9> ToggleTimer </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Model</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            current </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>DateTime</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            enabled </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>bool</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Msg</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Tick </span><span class=mtk14>of</span><span class=mtk1> now</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>DateTime</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Toggle </span><span class=mtk14>of</span><span class=mtk1> enabled</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>bool</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>init</span><span class=mtk1> </span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            current </span><span class=mtk14>=</span><span class=mtk1> DateTime.MinValue</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            enabled </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk6>true</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>},</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span></code></pre><p>Now let's handle the <code>Toggle</code> message.<pre class="atom-one-light grvsc-container"data-index=4 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>update</span><span class=mtk1> msg model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>match</span><span class=mtk1> msg </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Tick now </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span><span class=mtk1> model </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                current </span><span class=mtk14>=</span><span class=mtk1> now</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>},</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Toggle enabled </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span><span class=mtk1> model </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                enabled </span><span class=mtk14>=</span><span class=mtk1> enabled</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>},</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span></code></pre><p><code>timer</code> is the same as before.<pre class="atom-one-light grvsc-container"data-index=5 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>timer</span><span class=mtk1> onTick </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>start</span><span class=mtk1> dispatch </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>intervalId</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                JS.setInterval</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span><span class=mtk1> dispatch </span><span class=mtk14>(</span><span class=mtk1>onTick DateTime.Now</span><span class=mtk14>))</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    </span><span class=mtk6>1000</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span><span class=mtk1> </span><span class=mtk14>new</span><span class=mtk1> IDisposable </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>member</span><span class=mtk1> </span><span class=mtk5>_.Dispose</span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> JS.clearInterval intervalId </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        start</span></span></span></code></pre><p>Next, we change the subscribe function to check <code>enabled</code> before including the timer subscription.<pre class="atom-one-light grvsc-container"data-index=6 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>subscribe</span><span class=mtk1> model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>[</span><span class=mtk1> </span><span class=mtk14>if</span><span class=mtk1> model.enabled </span><span class=mtk14>then</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>[</span><span class=mtk10>"timer"</span><span class=mtk14>],</span><span class=mtk1> timer Tick </span><span class=mtk14>]</span></span></span></code></pre><p>Now let's add an HTML view to visualize and control the timer.<pre class="atom-one-light grvsc-container"data-index=7 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Feliz</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>view</span><span class=mtk1> model dispatch </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>timestamp</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> model.current.ToString</span><span class=mtk14>(</span><span class=mtk10>"yyyy-MM-dd HH:mm:ss.ffff"</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        Html.div </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Html.div </span><span class=mtk14>[</span><span class=mtk1>Html.text timestamp</span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Html.div </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                Html.label </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    prop.children </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                        Html.input </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                            prop.type' </span><span class=mtk10>"checkbox"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                            prop.isChecked model.enabled</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                            prop.onCheckedChange </span><span class=mtk14>(fun</span><span class=mtk1> b </span><span class=mtk14>-></span><span class=mtk1> dispatch </span><span class=mtk14>(</span><span class=mtk1>Toggle b</span><span class=mtk14>))</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                        </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                        Html.text </span><span class=mtk10>" enabled"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    Program.mkProgram init update view</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|></span><span class=mtk1> Program.withSubscription subscribe</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|></span><span class=mtk1> Program.run</span></span></span></code></pre><p>Here is the running program.<p><img alt="demo of user toggling checkbox to stop and start time updates"src=../static/img/timer-with-enable.gif><h3 id=aggregating-multiple-subscribers>Aggregating multiple subscribers<a href=#aggregating-multiple-subscribers aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><p>If you need to aggregate multiple subscriptions follow the same pattern as when implementing <code>init</code>, <code>update</code>, and <code>view</code> functions - delegate to child components to setup their own subscriptions.<p>For example:<pre class="atom-one-light grvsc-container"data-index=8 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>module</span><span class=mtk9> Sub </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class="mtk7 mtki">// now usable for different intervals</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>timer</span><span class=mtk1> intervalMs onTick </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>start</span><span class=mtk1> dispatch </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>intervalId</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                JS.setInterval</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span><span class=mtk1> dispatch </span><span class=mtk14>(</span><span class=mtk1>onTick DateTime.Now</span><span class=mtk14>))</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    intervalMs</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span><span class=mtk1> </span><span class=mtk14>new</span><span class=mtk1> IDisposable </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>member</span><span class=mtk1> </span><span class=mtk5>_.Dispose</span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> JS.clearInterval intervalId </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        start</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>module</span><span class=mtk9> Second </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Msg</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Second </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>int</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Model</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> int</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>init</span><span class=mtk1> </span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk6>0</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>update</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>Second seconds</span><span class=mtk14>)</span><span class=mtk1> model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        seconds</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>subscribe</span><span class=mtk1> model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>[</span><span class=mtk1> </span><span class=mtk14>[</span><span class=mtk10>"timer"</span><span class=mtk14>],</span><span class=mtk1> Sub.timer </span><span class=mtk6>1000</span><span class=mtk1> </span><span class=mtk14>(fun</span><span class=mtk1> now </span><span class=mtk14>-></span><span class=mtk1> Second now.Second</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>module</span><span class=mtk9> Hour </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Msg</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Hour </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>int</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Model</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> int</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>init</span><span class=mtk1> </span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk6>0</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>update</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>Hour hour</span><span class=mtk14>)</span><span class=mtk1> model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        hour</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>subscribe</span><span class=mtk1> model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>[</span><span class=mtk1> </span><span class=mtk14>[</span><span class=mtk10>"timer"</span><span class=mtk14>],</span><span class=mtk1> Sub.timer </span><span class=mtk14>(</span><span class=mtk6>60</span><span class=mtk14>*</span><span class=mtk6>1000</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>(fun</span><span class=mtk1> now </span><span class=mtk14>-></span><span class=mtk1> Hour now.Hour</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>module</span><span class=mtk9> App </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Model</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            seconds </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Second</span><span class=mtk1>.</span><span class=mtk4>Model</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            hours </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Hour</span><span class=mtk1>.</span><span class=mtk4>Model</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Msg</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> SecondMsg </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>Second.Msg</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> HourMsg </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>Hour.Msg</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>init</span><span class=mtk1> </span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>seconds</span><span class=mtk14>,</span><span class=mtk1> secondsCmd </span><span class=mtk14>=</span><span class=mtk1> Second.init </span><span class=mtk6>()</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>hours</span><span class=mtk14>,</span><span class=mtk1> hoursCmd </span><span class=mtk14>=</span><span class=mtk1> Hour.init </span><span class=mtk6>()</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            seconds </span><span class=mtk14>=</span><span class=mtk1> seconds</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            hours </span><span class=mtk14>=</span><span class=mtk1> hours</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>},</span><span class=mtk1> Cmd.batch </span><span class=mtk14>[</span><span class=mtk1>Cmd.map SecondMsg secondsCmd</span><span class=mtk14>;</span><span class=mtk1> Cmd.map HourMsg hoursCmd</span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>update</span><span class=mtk1> msg model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>match</span><span class=mtk1> msg </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> HourMsg msg </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>hours</span><span class=mtk14>,</span><span class=mtk1> hoursCmd </span><span class=mtk14>=</span><span class=mtk1> Hour.update msg model.hours</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span><span class=mtk1> model </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                hours </span><span class=mtk14>=</span><span class=mtk1> hours</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>},</span><span class=mtk1> Cmd.map HourMsg hoursCmd</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> SecondMsg msg </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>seconds</span><span class=mtk14>,</span><span class=mtk1> secondsCmd </span><span class=mtk14>=</span><span class=mtk1> Second.update msg model.seconds</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span><span class=mtk1> model </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                seconds </span><span class=mtk14>=</span><span class=mtk1> seconds</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>},</span><span class=mtk1> Cmd.map SecondMsg secondsCmd</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>subscribe</span><span class=mtk1> model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        Sub.batch </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Sub.map </span><span class=mtk10>"hour"</span><span class=mtk1> HourMsg </span><span class=mtk14>(</span><span class=mtk1>Hour.subscribe model.hours</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Sub.map </span><span class=mtk10>"second"</span><span class=mtk1> SecondMsg </span><span class=mtk14>(</span><span class=mtk1>Second.subscribe model.seconds</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    Program.mkProgram init update </span><span class=mtk14>(fun</span><span class=mtk1> model _ </span><span class=mtk14>-></span><span class=mtk1> printf </span><span class=mtk10>"</span><span class=mtk14>%A</span><span class=mtk6>\n</span><span class=mtk10>"</span><span class=mtk1> model</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|></span><span class=mtk1> Program.withSubscription subscribe</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|></span><span class=mtk1> Program.run</span></span></span></code></pre><p>Notice <code>Sub.map</code> takes an id prefix as its first parameter. This helps keep subscriptions distinct from each other.<p>Before <code>Sub.map</code>, Second and Hour have the same ID: <code>["timer"]</code>. After <code>Sub.map</code>, their IDs are: <code>["hour"; "timer"]</code> and <code>["second"; "timer"]</code>.<p>It is common for parent pages to have one active child page. This partial example shows <code>subscribe</code> in that case.<pre class="atom-one-light grvsc-container"data-index=9 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Msg</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> SecondMsg </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>Second.Msg</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> HourMsg </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>Hour.Msg</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Page</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Second </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>Second.Model</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Hour </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>Hour.Model</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Model</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            page</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Page</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>subscribe</span><span class=mtk1> model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>match</span><span class=mtk1> model.page </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Second model</span><span class=mtk14>_</span><span class=mtk1> </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Sub.map </span><span class=mtk10>"second"</span><span class=mtk1> SecondMsg </span><span class=mtk14>(</span><span class=mtk1>Second.subscribe model</span><span class=mtk14>_)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Hour model</span><span class=mtk14>_</span><span class=mtk1> </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Sub.map </span><span class=mtk10>"hour"</span><span class=mtk1> HourMsg </span><span class=mtk14>(</span><span class=mtk1>Hour.subscribe model</span><span class=mtk14>_)</span></span></span></code></pre><p>When the active page changes, the old page's subscriptions are stopped and the new page's subscriptions are started.<h3 id=subscription-reusability>Subscription reusability<a href=#subscription-reusability aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><blockquote><p>ð <strong>Effect</strong><p>The <code>Effect</code> type was known as <code>Sub</code> in v3. With the change to subscriptions, <code>Sub</code> would have been an overloaded and confusing term. Helper functions have also been renamed. For example, <code>Cmd.ofSub</code> is now <code>Cmd.ofEffect</code>. This is a change in name only -- <code>Effect</code> works exactly the same as v3 <code>Sub</code>.</blockquote><p>In the last section, we increased reusability of the timer by taking the interval as a parameter. We can use Effect to factor out the hard-coded <code>DateTime.Now</code> behavior for even more reuse.<p>First let's turn <code>DateTime.Now</code> into an Effect.<pre class="atom-one-light grvsc-container"data-index=10 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>module</span><span class=mtk9> EffectTimer </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>module</span><span class=mtk9> Time </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>now</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>tag</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>DateTime </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk4>'msg</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Effect</span><span class=mtk14>&lt;</span><span class=mtk4>'msg</span><span class=mtk14>></span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>effectFn</span><span class=mtk1> dispatch </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                dispatch </span><span class=mtk14>(</span><span class=mtk1>tag DateTime.Now</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            effectFn</span></span></span></code></pre><blockquote><p>Strange as it seems, <code>DateTime.Now</code> is a side effect. This property reads from a clock and may return a different value each time. Code that uses it becomes nondeterministic.</blockquote><p>Now let's change timer to run an <code>Effect</code> when the interval fires.<pre class="atom-one-light grvsc-container"data-index=11 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>module</span><span class=mtk9> Sub </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>timer</span><span class=mtk1> intervalMs </span><span class=mtk14>(</span><span class=mtk1>effect</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Effect</span><span class=mtk14>&lt;</span><span class=mtk4>'msg</span><span class=mtk14>>)</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>start</span><span class=mtk1> dispatch </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>intervalId</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    JS.setInterval </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span><span class=mtk1> effect dispatch</span><span class=mtk14>)</span><span class=mtk1> intervalMs</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>{</span><span class=mtk1> </span><span class=mtk14>new</span><span class=mtk1> IDisposable </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    </span><span class=mtk14>member</span><span class=mtk1> </span><span class=mtk5>_.Dispose</span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> JS.clearInterval intervalId </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            start</span></span></span></code></pre><p>And finally, here is the updated <code>subscribe</code> function.<pre class="atom-one-light grvsc-container"data-index=12 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Model</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            current </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>DateTime</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            intervalMs </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Msg</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Tick </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>DateTime</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>subscribe</span><span class=mtk1> model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>[</span><span class=mtk1> </span><span class=mtk14>[</span><span class=mtk10>"timer"</span><span class=mtk14>],</span><span class=mtk1> Sub.timer model.intervalMs </span><span class=mtk14>(</span><span class=mtk1>Time.now Tick</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>]</span></span></span></code></pre><p>The timer subscription can now run any kind of effect. Calling an API, playing a sound, etc.<p><code>Time.now</code> is also usable for Cmds.<pre class="atom-one-light grvsc-container"data-index=13 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>init</span><span class=mtk1> </span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            current </span><span class=mtk14>=</span><span class=mtk1> DateTime.MinValue</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            intervalMs </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk6>1000</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>,</span><span class=mtk1> Cmd.ofEffect </span><span class=mtk14>(</span><span class=mtk1>Time.now Tick</span><span class=mtk14>)</span></span></span></code></pre><h3 id=ids-and-dependencies>IDs and dependencies<a href=#ids-and-dependencies aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><p>Earlier we noted that ID is a list so that you can add dependencies to it. We'll use that to improve the last example.<p>In that example, the timer's interval came from the model:<pre class="atom-one-light grvsc-container"data-index=14 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>Sub.timer model.intervalMs </span><span class=mtk14>(</span><span class=mtk1>Time.now Tick</span><span class=mtk14>)</span></span></span></code></pre><p>But nothing happens to the subscription if <code>model.intervalMs</code> changes. Let's fix that.<pre class="atom-one-light grvsc-container"data-index=15 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>subscribe</span><span class=mtk1> model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>subId</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk14>[</span><span class=mtk10>"timer"</span><span class=mtk14>;</span><span class=mtk1> string model.intervalMs</span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>[</span><span class=mtk1> subId</span><span class=mtk14>,</span><span class=mtk1> Sub.timer model.intervalMs </span><span class=mtk14>(</span><span class=mtk1>Time.now Tick</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>]</span></span></span></code></pre><p>Now that <code>intervalMs</code> is part of the ID, the timer will stop the old interval then start with the new interval whenever the interval changes.<p>How does it work? It is taking advantage of ID uniqueness. Let's say that <code>intervalMs</code> is initially 1000. The sub ID is <code>["timer"; "1000"]</code>, Elmish starts the subscription. Then <code>intervalMs</code> changes to 2000. The sub ID becomes <code>["timer"; "2000"]</code>. Elmish sees that <code>["timer"; "1000"]</code> is no longer active and stops it. Then it starts the "new" subscription <code>["timer"; "2000"]</code>.<p>To Elmish each interval is a different subscription. But to <code>subscribe</code> this is a single timer that changes intervals.<p>Let's look at another example: multiple timers. This one will be a full-fledged example including UI forms to take user input.<pre class="atom-one-light grvsc-container"data-index=16 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>module</span><span class=mtk9> MultipleTimers </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>module</span><span class=mtk9> Time </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>now</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>tag</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>DateTime </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk4>'msg</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Effect</span><span class=mtk14>&lt;</span><span class=mtk4>'msg</span><span class=mtk14>></span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>effectFn</span><span class=mtk1> dispatch </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                dispatch </span><span class=mtk14>(</span><span class=mtk1>tag DateTime.Now</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            effectFn</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>module</span><span class=mtk9> Sub </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>timer</span><span class=mtk1> intervalMs </span><span class=mtk14>(</span><span class=mtk1>effect</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Effect</span><span class=mtk14>&lt;</span><span class=mtk4>'msg</span><span class=mtk14>>)</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>start</span><span class=mtk1> dispatch </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>intervalId</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    JS.setInterval </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span><span class=mtk1> effect dispatch</span><span class=mtk14>)</span><span class=mtk1> intervalMs</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>{</span><span class=mtk1> </span><span class=mtk14>new</span><span class=mtk1> IDisposable </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    </span><span class=mtk14>member</span><span class=mtk1> </span><span class=mtk5>_.Dispose</span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> JS.clearInterval intervalId </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            start</span></span></span></code></pre><p>This includes the same <code>Sub.timer</code> subscription and <code>Time.now</code> effect from the last example.<p>Now let's create a reusable form that accepts timer interval changes and validates them.<pre class="atom-one-light grvsc-container"data-index=17 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class="mtk7 mtki">// type aliases to make the model more legible, in theory</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>TimerId</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> int</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>IntervalMs</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> int</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>FormState</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Unchanged</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> NewValue </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>IntervalMs</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Invalid </span><span class=mtk14>of</span><span class=mtk1> error</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>IntervalForm</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            current </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>IntervalMs</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            userEntry </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            state </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>FormState</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>module</span><span class=mtk9> IntervalForm </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk8> [&#60Literal>]</span><span class=mtk1> </span><span class=mtk5>NoInterval</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk14>-</span><span class=mtk6>1</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>empty</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                current </span><span class=mtk14>=</span><span class=mtk1> NoInterval</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                userEntry </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk10>""</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                state </span><span class=mtk14>=</span><span class=mtk1> Unchanged</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>create</span><span class=mtk1> intervalMs </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                current </span><span class=mtk14>=</span><span class=mtk1> intervalMs</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                userEntry </span><span class=mtk14>=</span><span class=mtk1> string intervalMs</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                state </span><span class=mtk14>=</span><span class=mtk1> Unchanged</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>reset</span><span class=mtk1> form </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>userEntry</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>if</span><span class=mtk1> form.current </span><span class=mtk14>=</span><span class=mtk1> NoInterval </span><span class=mtk14>then</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    </span><span class=mtk10>""</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>else</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    string form.current</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span><span class=mtk1>form </span><span class=mtk14>with</span><span class=mtk1> userEntry </span><span class=mtk14>=</span><span class=mtk1> userEntry</span><span class=mtk14>;</span><span class=mtk1> state </span><span class=mtk14>=</span><span class=mtk1> Unchanged</span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>validate</span><span class=mtk1> form </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>match</span><span class=mtk1> Int32.TryParse form.userEntry </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>|</span><span class=mtk1> </span><span class=mtk6>false</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>_</span><span class=mtk1> </span><span class=mtk14>when</span><span class=mtk1> form.current </span><span class=mtk14>=</span><span class=mtk1> NoInterval </span><span class=mtk14>&#38&amp</span><span class=mtk1> form.userEntry </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk10>""</span><span class=mtk1> </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>{</span><span class=mtk1>form </span><span class=mtk14>with</span><span class=mtk1> state </span><span class=mtk14>=</span><span class=mtk1> Unchanged</span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>|</span><span class=mtk1> </span><span class=mtk6>false</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>_</span><span class=mtk1> </span><span class=mtk14>when</span><span class=mtk1> form.userEntry </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk10>""</span><span class=mtk1> </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>{</span><span class=mtk1>form </span><span class=mtk14>with</span><span class=mtk1> state </span><span class=mtk14>=</span><span class=mtk1> Invalid </span><span class=mtk10>"cannot be blank"</span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>|</span><span class=mtk1> </span><span class=mtk6>false</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>_</span><span class=mtk1> </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>{</span><span class=mtk1>form </span><span class=mtk14>with</span><span class=mtk1> state </span><span class=mtk14>=</span><span class=mtk1> Invalid </span><span class=mtk10>"must be an integer"</span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>|</span><span class=mtk1> </span><span class=mtk6>true</span><span class=mtk14>,</span><span class=mtk1> interval </span><span class=mtk14>when</span><span class=mtk1> interval </span><span class=mtk14>&#60=</span><span class=mtk1> </span><span class=mtk6>0</span><span class=mtk1> </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>{</span><span class=mtk1>form </span><span class=mtk14>with</span><span class=mtk1> state </span><span class=mtk14>=</span><span class=mtk1> Invalid </span><span class=mtk10>"must be greater than zero"</span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>|</span><span class=mtk1> </span><span class=mtk6>true</span><span class=mtk14>,</span><span class=mtk1> interval </span><span class=mtk14>when</span><span class=mtk1> interval </span><span class=mtk14>=</span><span class=mtk1> form.current </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>{</span><span class=mtk1>form </span><span class=mtk14>with</span><span class=mtk1> state </span><span class=mtk14>=</span><span class=mtk1> Unchanged</span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>|</span><span class=mtk1> </span><span class=mtk6>true</span><span class=mtk14>,</span><span class=mtk1> interval </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>{</span><span class=mtk1>form </span><span class=mtk14>with</span><span class=mtk1> state </span><span class=mtk14>=</span><span class=mtk1> NewValue interval</span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>userEntry</span><span class=mtk1> text form </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            validate </span><span class=mtk14>{</span><span class=mtk1>form </span><span class=mtk14>with</span><span class=mtk1> userEntry </span><span class=mtk14>=</span><span class=mtk1> text</span><span class=mtk14>}</span></span></span></code></pre><p>Now let's create the overall model to manage timers.<pre class="atom-one-light grvsc-container"data-index=18 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Model</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class="mtk7 mtki">// lookup by TimerId, last tick and interval settings</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            timers </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Map</span><span class=mtk14>&lt;</span><span class=mtk4>TimerId</span><span class=mtk14>,</span><span class=mtk4> DateTime </span><span class=mtk14>*</span><span class=mtk4> IntervalForm</span><span class=mtk14>></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class="mtk7 mtki">// incrementing ID</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            nextId </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>TimerId</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class="mtk7 mtki">// form for the user to add a new interval</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            addForm </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>IntervalForm</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Msg</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> AddFormReset</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> AddFormUserEntry </span><span class=mtk14>of</span><span class=mtk1> text</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> ChangeFormReset </span><span class=mtk14>of</span><span class=mtk1> timerId</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> ChangeFormUserEntry </span><span class=mtk14>of</span><span class=mtk1> timerId</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int</span><span class=mtk1> </span><span class=mtk14>*</span><span class=mtk1> text</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> AddTimer </span><span class=mtk14>of</span><span class=mtk1> intervalMs</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> RemoveTimer </span><span class=mtk14>of</span><span class=mtk1> timerId</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> ChangeInterval </span><span class=mtk14>of</span><span class=mtk1> timerId</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int</span><span class=mtk1> </span><span class=mtk14>*</span><span class=mtk1> intervalMs</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Tick </span><span class=mtk14>of</span><span class=mtk1> timerId</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int</span><span class=mtk1> </span><span class=mtk14>*</span><span class=mtk1> now</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>DateTime</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>     </span><span class=mtk14>module</span><span class=mtk9> Model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>updateTimer</span><span class=mtk1> timerId f model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span><span class=mtk1> model </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                timers </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    model.timers</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    </span><span class=mtk14>|></span><span class=mtk1> Map.change timerId </span><span class=mtk14>(</span><span class=mtk1>Option.map f</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>updateForm</span><span class=mtk1> timerId f model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            model </span><span class=mtk14>|></span><span class=mtk1> updateTimer timerId </span><span class=mtk14>(fun</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>now</span><span class=mtk14>,</span><span class=mtk1> form</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> now</span><span class=mtk14>,</span><span class=mtk1> f form</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>updateNow</span><span class=mtk1> timerId newNow model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            model </span><span class=mtk14>|></span><span class=mtk1> updateTimer timerId </span><span class=mtk14>(fun</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>now</span><span class=mtk14>,</span><span class=mtk1> form</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> newNow</span><span class=mtk14>,</span><span class=mtk1> form</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>init</span><span class=mtk1> </span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            timers </span><span class=mtk14>=</span><span class=mtk1> Map.empty</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            nextId </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk6>1</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            addForm </span><span class=mtk14>=</span><span class=mtk1> IntervalForm.empty</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>},</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>update</span><span class=mtk1> msg model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>match</span><span class=mtk1> msg </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class="mtk7 mtki">// form changes</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> AddFormReset </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span><span class=mtk1> model </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                addForm </span><span class=mtk14>=</span><span class=mtk1> IntervalForm.reset model.addForm</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>},</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> AddFormUserEntry text </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span><span class=mtk1> model </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                addForm </span><span class=mtk14>=</span><span class=mtk1> IntervalForm.userEntry text model.addForm</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>},</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> ChangeFormReset timerId </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Model.updateForm timerId IntervalForm.reset model</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> ChangeFormUserEntry </span><span class=mtk14>(</span><span class=mtk1>timerId</span><span class=mtk14>,</span><span class=mtk1> text</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Model.updateForm timerId </span><span class=mtk14>(</span><span class=mtk1>IntervalForm.userEntry text</span><span class=mtk14>)</span><span class=mtk1> model</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class="mtk7 mtki">// timer changes</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> AddTimer intervalMs </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span><span class=mtk1> model </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                timers </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>form</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> IntervalForm.create intervalMs</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    Map.add model.nextId </span><span class=mtk14>(</span><span class=mtk1>DateTime.MinValue</span><span class=mtk14>,</span><span class=mtk1> form</span><span class=mtk14>)</span><span class=mtk1> model.timers</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                nextId </span><span class=mtk14>=</span><span class=mtk1> model.nextId </span><span class=mtk14>+</span><span class=mtk1> </span><span class=mtk6>1</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                addForm </span><span class=mtk14>=</span><span class=mtk1> IntervalForm.empty</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>},</span><span class=mtk1> </span><span class=mtk14>[</span><span class=mtk1>Time.now </span><span class=mtk14>(fun</span><span class=mtk1> now </span><span class=mtk14>-></span><span class=mtk1> Tick </span><span class=mtk14>(</span><span class=mtk1>model.nextId</span><span class=mtk14>,</span><span class=mtk1> now</span><span class=mtk14>))]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> RemoveTimer timerId </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span><span class=mtk1> model </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                timers </span><span class=mtk14>=</span><span class=mtk1> Map.remove timerId model.timers</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>},</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> ChangeInterval </span><span class=mtk14>(</span><span class=mtk1>timerId</span><span class=mtk14>,</span><span class=mtk1> intervalMs</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>form</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> IntervalForm.create intervalMs</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Model.updateForm timerId </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span><span class=mtk1> form</span><span class=mtk14>)</span><span class=mtk1> model</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Tick </span><span class=mtk14>(</span><span class=mtk1>timerId</span><span class=mtk14>,</span><span class=mtk1> now</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Model.updateNow timerId now model</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>[]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>subscribe</span><span class=mtk1> model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>for</span><span class=mtk1> timerId</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>(_</span><span class=mtk1>now</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>{</span><span class=mtk1>current </span><span class=mtk14>=</span><span class=mtk1> intervalMs</span><span class=mtk14>})</span><span class=mtk1> </span><span class=mtk14>in</span><span class=mtk1> Map.toList model.timers </span><span class=mtk14>do</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>subId</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk14>[</span><span class=mtk10>"timer"</span><span class=mtk14>;</span><span class=mtk1> string timerId</span><span class=mtk14>;</span><span class=mtk1> string intervalMs</span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>tick</span><span class=mtk1> now </span><span class=mtk14>=</span><span class=mtk1> Tick </span><span class=mtk14>(</span><span class=mtk1>timerId</span><span class=mtk14>,</span><span class=mtk1> now</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                subId</span><span class=mtk14>,</span><span class=mtk1> Sub.timer intervalMs </span><span class=mtk14>(</span><span class=mtk1>Time.now tick</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>]</span></span></span></code></pre><p>In the subscription IDs, we included <code>timerId</code> and <code>intervalMs</code>. Each serves a slightly different purpose.<p>We can't use just "timer" because it won't be unique. <code>timerId</code> provides a unique (auto-incrementing) ID, so it satisfies that requirement. Any data we add to the ID beyond that, like <code>intervalMs</code> will cause the subscription to restart when that data changes. This is perfect for settings that affect the subscription runtime behavior, like interval changes.<p>Note that "timer" isn't needed in the ID here. Since timerId is providing uniqueness, "timer" is only a prefix now. A prefix might still be useful if there are other subscriptions on that page.<p>Let's finish things off with view functions.<pre class="atom-one-light grvsc-container"data-index=19 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Feliz</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>formView</span><span class=mtk1> resetTag userEntryTag saveTag </span><span class=mtk14>(</span><span class=mtk1>saveText</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string</span><span class=mtk14>)</span><span class=mtk1> form dispatch </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        Html.div </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Html.text </span><span class=mtk10>" "</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Html.input </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                prop.type'.text</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                prop.value form.userEntry</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                prop.onChange </span><span class=mtk14>(fun</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>text</span><span class=mtk14>:</span><span class=mtk4> string</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> dispatch </span><span class=mtk14>(</span><span class=mtk1>userEntryTag text</span><span class=mtk14>))</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Html.text </span><span class=mtk10>" "</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Html.button </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                prop.type'.button</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                prop.text saveText</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>match</span><span class=mtk1> form.state </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>|</span><span class=mtk1> Unchanged </span><span class=mtk14>|</span><span class=mtk1> Invalid </span><span class=mtk14>_</span><span class=mtk1> </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    prop.disabled </span><span class=mtk6>true</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>|</span><span class=mtk1> NewValue intervalMs </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    prop.onClick </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span><span class=mtk1> dispatch </span><span class=mtk14>(</span><span class=mtk1>saveTag intervalMs</span><span class=mtk14>))</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Html.text </span><span class=mtk10>" "</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Html.a </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                prop.text </span><span class=mtk10>"Reset"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                prop.style </span><span class=mtk14>[</span><span class=mtk1>style.userSelect.none</span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>match</span><span class=mtk1> form.state </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>|</span><span class=mtk1> Unchanged </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    prop.disabled </span><span class=mtk6>true</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    prop.style </span><span class=mtk14>[</span><span class=mtk1>style.color.gray</span><span class=mtk14>;</span><span class=mtk1> style.pointerEvents.none</span><span class=mtk14>;</span><span class=mtk1> style.userSelect.none</span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>|</span><span class=mtk1> </span><span class=mtk14>_</span><span class=mtk1> </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    prop.onClick </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span><span class=mtk1> dispatch resetTag</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Html.text </span><span class=mtk10>" "</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Html.br </span><span class=mtk14>[]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>match</span><span class=mtk1> form.state </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>|</span><span class=mtk1> Unchanged </span><span class=mtk14>|</span><span class=mtk1> NewValue </span><span class=mtk14>_</span><span class=mtk1> </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                Html.span </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    prop.style </span><span class=mtk14>[</span><span class=mtk1>style.visibility.hidden</span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    prop.text </span><span class=mtk10>"no error"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>|</span><span class=mtk1> Invalid error </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                Html.span </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    prop.style </span><span class=mtk14>[</span><span class=mtk1>style.color.orangeRed</span><span class=mtk14>;</span><span class=mtk1> style.fontSize </span><span class=mtk14>(</span><span class=mtk1>length.rem </span><span class=mtk6>0.8</span><span class=mtk14>)]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    prop.text error</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>view</span><span class=mtk1> model dispatch </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        Html.div </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            prop.style </span><span class=mtk14>[</span><span class=mtk1>style.padding </span><span class=mtk14>(</span><span class=mtk1>length.px </span><span class=mtk6>12</span><span class=mtk14>)]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            prop.children </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                Html.style</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    </span><span class=mtk10>"""</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>                    table {border-collapse: collapse; border-spacing: 0; box-sizing: border-box; border: 1px solid gray}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>                    table th, table td {padding: 3px 12px}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>                    """</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                Html.h4 </span><span class=mtk10>"Add a timer"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                formView AddFormReset AddFormUserEntry AddTimer </span><span class=mtk10>"Add"</span><span class=mtk1> model.addForm dispatch</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                Html.h4 </span><span class=mtk10>"Timers"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                Html.table </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    Html.thead </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                        Html.tr </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                            Html.th </span><span class=mtk10>" "</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                            Html.th </span><span class=mtk10>" Timer ID "</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                            Html.th </span><span class=mtk10>" Last Tick "</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                            Html.th </span><span class=mtk10>" Interval (ms) "</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                        </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    Html.tbody </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                        </span><span class=mtk14>for</span><span class=mtk1> timerId</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>now</span><span class=mtk14>,</span><span class=mtk1> form</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>in</span><span class=mtk1> Map.toList model.timers </span><span class=mtk14>do</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                            Html.tr </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                prop.key timerId</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                prop.children </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                    Html.td </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                        Html.text </span><span class=mtk10>" "</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                        Html.button </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                            prop.type' </span><span class=mtk10>"button"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                            prop.onClick </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span><span class=mtk1> dispatch </span><span class=mtk14>(</span><span class=mtk1>RemoveTimer timerId</span><span class=mtk14>))</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                            prop.text </span><span class=mtk10>" X "</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                        </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                        Html.text </span><span class=mtk10>" "</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                    </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                    Html.td </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                        prop.style </span><span class=mtk14>[</span><span class=mtk1>style.textAlign.right</span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                        prop.text </span><span class=mtk14>(</span><span class=mtk10>" "</span><span class=mtk1> </span><span class=mtk14>+</span><span class=mtk1> string timerId </span><span class=mtk14>+</span><span class=mtk1> </span><span class=mtk10>" "</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                    </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                    Html.td </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                        Html.div </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                            prop.key </span><span class=mtk14>(</span><span class=mtk1>string now.Ticks</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                            </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>timestampStr</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                                </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>s</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> now.ToString</span><span class=mtk14>(</span><span class=mtk10>"yyyy-MM-dd HH:mm:ss.ffff"</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                                </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>zeros</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk6>23</span><span class=mtk1> </span><span class=mtk14>-</span><span class=mtk1> s.Length</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                                s </span><span class=mtk14>+</span><span class=mtk1> String.replicate zeros </span><span class=mtk10>"0"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                            prop.text timestampStr</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                        </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                    </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                    Html.td </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>reset</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> ChangeFormReset timerId</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>userEntry</span><span class=mtk1> text </span><span class=mtk14>=</span><span class=mtk1> ChangeFormUserEntry </span><span class=mtk14>(</span><span class=mtk1>timerId</span><span class=mtk14>,</span><span class=mtk1> text</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>save</span><span class=mtk1> intervalMs </span><span class=mtk14>=</span><span class=mtk1> ChangeInterval </span><span class=mtk14>(</span><span class=mtk1>timerId</span><span class=mtk14>,</span><span class=mtk1> intervalMs</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                        formView reset userEntry save </span><span class=mtk10>"Save"</span><span class=mtk1> form dispatch</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                    </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                                </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                            </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    Program.mkProgram init update view</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|></span><span class=mtk1> Program.withSubscription subscribe</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|></span><span class=mtk1> Program.run</span></span></span></code></pre><p>Here is a demo.<p><img alt="demo of user adding updating and removing timers in a table"src=../static/img/timer-multi.gif><h3 id=migrating-from-v3>Migrating from v3<a href=#migrating-from-v3 aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><p>Migrating from Elmish v3 is fairly simple. First we will look at what we have from V3.<h4 id=v3-example>v3 example<a href=#v3-example aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h4><pre class="atom-one-light grvsc-container"data-index=20 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class="mtk7 mtki">// from v3 docs</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>module</span><span class=mtk9> V3Sub </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>System</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Model</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            current </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>DateTime</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Msg</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Tick </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>DateTime</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>init</span><span class=mtk1> </span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            current </span><span class=mtk14>=</span><span class=mtk1> DateTime.Now</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>update</span><span class=mtk1> msg model </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>match</span><span class=mtk1> msg </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Tick current </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{</span><span class=mtk1> model </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                current </span><span class=mtk14>=</span><span class=mtk1> current</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>}</span></span></span></code></pre><p>Here is the main part we are concerned with: the subscription. Type annotations have been added.<pre class="atom-one-light grvsc-container"data-index=21 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Elmish</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Fable.Core</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>timer</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>initial</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Model</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Cmd</span><span class=mtk14>&lt;</span><span class=mtk4>Msg</span><span class=mtk14>></span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>sub</span><span class=mtk1> dispatch </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            JS.setInterval</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    dispatch </span><span class=mtk14>(</span><span class=mtk1>Tick DateTime.Now</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk6>1000</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>|></span><span class=mtk1> ignore</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        Cmd.ofSub sub</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    Program.mkSimple init update </span><span class=mtk14>(fun</span><span class=mtk1> model _ </span><span class=mtk14>-></span><span class=mtk1> printf </span><span class=mtk10>"</span><span class=mtk14>%A</span><span class=mtk6>\n</span><span class=mtk10>"</span><span class=mtk1> model</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|></span><span class=mtk1> Program.withSubscription timer</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|></span><span class=mtk1> Program.run</span></span></span></code></pre><h4 id=v4-conversion>v4 conversion<a href=#v4-conversion aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h4><p>First, let's see the v4-migrated <code>timer</code> function. Then we'll go through the differences.<pre class="atom-one-light grvsc-container"data-index=22 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>timer</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>model</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Model</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk4>SubId </span><span class=mtk14>*</span><span class=mtk4> Subscribe</span><span class=mtk14>&lt;</span><span class=mtk4>Msg</span><span class=mtk14>>) </span><span class=mtk4>list </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>sub</span><span class=mtk1> dispatch </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>IDisposable </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            JS.setInterval</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    dispatch </span><span class=mtk14>(</span><span class=mtk1>Tick DateTime.Now</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk6>1000</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>|></span><span class=mtk1> ignore</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{new</span><span class=mtk1> IDisposable </span><span class=mtk14>with</span><span class=mtk1> </span><span class=mtk14>member</span><span class=mtk1> </span><span class=mtk5>_.Dispose</span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk6>()</span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>[</span><span class=mtk1> </span><span class=mtk14>[</span><span class=mtk10>"timer"</span><span class=mtk14>],</span><span class=mtk1> sub </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    Program.mkSimple init update </span><span class=mtk14>(fun</span><span class=mtk1> model _ </span><span class=mtk14>-></span><span class=mtk1> printf </span><span class=mtk10>"</span><span class=mtk14>%A</span><span class=mtk6>\n</span><span class=mtk10>"</span><span class=mtk1> model</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|></span><span class=mtk1> Program.withSubscription timer</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|></span><span class=mtk1> Program.run</span></span></span></code></pre><h4 id=differences>Differences<a href=#differences aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h4><p>First, the function signature is different.<pre class="atom-one-light grvsc-container"data-index=23 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>                             </span><span class="mtk7 mtki">//vvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>timer</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>model</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Model</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk4>SubId </span><span class=mtk14>*</span><span class=mtk4> Subscribe</span><span class=mtk14>&lt;</span><span class=mtk4>Msg</span><span class=mtk14>>) </span><span class=mtk4>list </span><span class=mtk14>=</span></span></span></code></pre><p>Instead of returning <code>Cmd&#60Msg></code>, the subscription now returns a list containing <code>SubId</code>s and their associated <code>Subscribe</code> functions in a tuple.<p>To convert <code>sub</code> into a <code>Subscribe&#60Msg></code> function, the only change is that it returns an <code>IDisposable</code> instead of <code>unit</code>.<pre class="atom-one-light grvsc-container"data-index=24 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>                         </span><span class="mtk7 mtki">//vvvvvvvvvvv</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>sub</span><span class=mtk1> dispatch </span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>IDisposable </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            JS.setInterval</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    dispatch </span><span class=mtk14>(</span><span class=mtk1>Tick DateTime.Now</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk6>1000</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>|></span><span class=mtk1> ignore</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>{new</span><span class=mtk1> IDisposable </span><span class=mtk14>with</span><span class=mtk1> </span><span class=mtk14>member</span><span class=mtk1> </span><span class=mtk5>_.Dispose</span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk6>()</span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>          </span><span class="mtk7 mtki">//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span></span></code></pre><p>The <code>IDisposable</code> is meant to provide a way to stop the subscription. We used an empty <code>IDisposable</code> because v3 subscriptions did not have "stop" functionality. So this matches v3 behavior.<blockquote><p>If "stop" functionality was needed in v3, it had to be manually coded. By behaving like v3, the above remains compatible with any such code. Then the full v4 subscription functionality can be implemented when and if it is convenient.</blockquote><p>Now let's examine the return value.<pre class="atom-one-light grvsc-container"data-index=25 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>[</span><span class=mtk1> </span><span class=mtk14>[</span><span class=mtk10>"timer"</span><span class=mtk14>],</span><span class=mtk1> sub </span><span class=mtk14>]</span></span></span></code></pre><p>The return value is a list containing a single element: a combination of <code>["timer"]</code> (the subscription ID) and <code>sub</code> (the subscribe function) in a tuple. The subscription ID should be unique among other subscriptions in the list. For more info on why the ID is a list, see the section <a href=#ids-and-dependencies>IDs and dependencies</a>.<p>This is all that's necessary to migrate v3 subs to v4 to get an existing code base working. Subscriptions in v4 offer new functionality, such as automatically stopping or restarting subscriptions when the model changes. For more information, please consult the previous sections in this document. They offer a step-by-step guide to the new features.<h3 id=style-used-in-this-guide>Style used in this guide<a href=#style-used-in-this-guide aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><p>This guide uses a named fn, <code>start</code>, inside subscriptions for increased explicitness. The pattern looks like this:<pre class="atom-one-light grvsc-container"data-index=26 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>timer</span><span class=mtk1> intervalMs onTick </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>start</span><span class=mtk1> dispatch </span><span class=mtk14>=</span><span class=mtk1> </span><span class="mtk7 mtki">// define start fn</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>(</span><span class="mtk7 mtki">(* . . . *)</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        start </span><span class="mtk7 mtki">// return start fn</span></span></span></code></pre><p>In the source code of Elmish libraries, you will typically find anonymous function returns instead. Like this:<pre class="atom-one-light grvsc-container"data-index=27 data-language=fs><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>timer</span><span class=mtk1> intervalMs onTick </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>fun</span><span class=mtk1> dispatch </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>(</span><span class="mtk7 mtki">(* . . . *)</span><span class=mtk14>)</span></span></span></code></pre><p>Both styles are equivalent in functionality. Feel free to use whichever you prefer.</div></div></section><div class="section bd-docs-pagination bd-pagination-links"><a class="button bd-fat-button is-primary is-light bd-pagination-prev" href="/elmish/docs/parent-child.html"><i>â</i><span class="is-hidden-mobile"><em>Step by step</em><strong>Parent-child composition</strong></span></a><a class="button bd-fat-button is-primary is-light bd-pagination-next" href="/elmish/docs/subscriptionv3.html"><span class="is-hidden-mobile"><em>Step by step</em><strong>Subscriptions (v3)</strong></span><i>â</i></a></div></div></div></div></div><script async="" src="/elmish/resources/nacara-standard-layouts/scripts/menu.js"></script><footer class="footer"><div class="is-size-5"><div class="sitemap"><div class="sitemap-section"><div class="sitemap-section-title">Project ressources</div><ul class="sitemap-section-list"><li><a href="https://github.com/elmish/elmish" class="icon-text sitemap-section-list-item"><span class="icon"><i class="fas fa-file-code"></i></span><span class="sitemap-section-list-item-text">Repository</span></a></li><li><a href="/elmish/release_notes.html" class="icon-text sitemap-section-list-item"><span class="icon"><i class="fas fa-list"></i></span><span class="sitemap-section-list-item-text">Release notes</span></a></li><li><a href="https://github.com/elmish/elmish/blob/v4.x/LICENSE.md" class="icon-text sitemap-section-list-item"><span class="icon"><i class="fas fa-id-card"></i></span><span class="sitemap-section-list-item-text">License</span></a></li></ul></div><div class="sitemap-section"><div class="sitemap-section-title">Elmish modules</div><ul class="sitemap-section-list"><li><a href="https://elmish.github.io/elmish/" class="icon-text sitemap-section-list-item"><span class="icon"><i class="fa fa-book"></i></span><span class="sitemap-section-list-item-text">Fable.Elmish</span></a></li><li><a href="https://elmish.github.io/browser/" class="icon-text sitemap-section-list-item"><span class="icon"><i class="fa fa-book"></i></span><span class="sitemap-section-list-item-text">Fable.Elmish.Browser</span></a></li><li><a href="https://elmish.github.io/urlParser/" class="icon-text sitemap-section-list-item"><span class="icon"><i class="fa fa-book"></i></span><span class="sitemap-section-list-item-text">Fable.Elmish.UrlParser</span></a></li><li><a href="https://elmish.github.io/debugger/" class="icon-text sitemap-section-list-item"><span class="icon"><i class="fa fa-book"></i></span><span class="sitemap-section-list-item-text">Fable.Elmish.Debugger</span></a></li><li><a href="https://elmish.github.io/react/" class="icon-text sitemap-section-list-item"><span class="icon"><i class="fa fa-book"></i></span><span class="sitemap-section-list-item-text">Fable.Elmish.React</span></a></li><li><a href="https://elmish.github.io/hmr/" class="icon-text sitemap-section-list-item"><span class="icon"><i class="fa fa-book"></i></span><span class="sitemap-section-list-item-text">Fable.Elmish.HMR</span></a></li></ul></div><div class="sitemap-section"><div class="sitemap-section-title">Other Links</div><ul class="sitemap-section-list"><li><a href="https://fable.io" class="icon-text sitemap-section-list-item"><span class="icon"><i class="faf faf-fable"></i></span><span class="sitemap-section-list-item-text">Fable</span></a></li><li><a href="https://gitter.im/fable-compiler/Fable" class="icon-text sitemap-section-list-item"><span class="icon"><i class="fab fa-gitter"></i></span><span class="sitemap-section-list-item-text">Fable Gitter</span></a></li><li><a href="https://fsharp.org/guides/slack/" class="icon-text sitemap-section-list-item"><span class="icon"><i class="fab fa-slack"></i></span><span class="sitemap-section-list-item-text">F# Slack</span></a></li><li><a href="https://fsharp.org/" class="icon-text sitemap-section-list-item"><span class="icon"><i class="faf faf-fsharp-org"></i></span><span class="sitemap-section-list-item-text">F# Software Foundation</span></a></li></ul></div></div><p class="has-text-centered">Built with <a class="is-underlined" href="https://mangelmaxime.github.io/Nacara/">Nacara</a></p><p class="has-text-centered mt-2">Copyright Â© 2021-<span id="copyright-end-year"></span> Elmish contributors.</p><script>
        const year = new Date().getFullYear();
        document.getElementById('copyright-end-year').innerHTML = year;
        </script></div></footer></body></html>