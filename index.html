<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Elmish
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Elm-like Cmd and Program modules for F# apps"/>
    <meta name="author" content="Eugene Tolmachev"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="https://elmish.github.io/elmish/content/style_light.css" />
    <script type="text/javascript" src="https://elmish.github.io/elmish/content/tips.js"></script>
    <style>span.l { display: none }</style>
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="https://elmish.github.io">elmish</a></li>
          <li><a href="http://fable.io">fable</a></li>
          <li><a href="http://fsharp.org">fsharp.org</a></li>
        </ul>
        <h3 class="muted"><a href="https://elmish.github.io/elmish/index.html">elmish</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Elmish" class="anchor" href="#Elmish">Elmish</a></h1>
<blockquote>
<p><code>-ish</code> <br />
a suffix used to convey the sense of “having some characteristics of”</p>
</blockquote>
<p>Elmish implements core abstractions that can be used to build Fable applications following the <a href="https://guide.elm-lang.org/architecture/">“model view update”</a> style of architecture, as made famous by Elm.</p>
<p>The goal of the architecture is to provide a solid UI-independent core to build the rest of the functionality around.
Elm architecture operates using the following concepts, as they translate to Elmish:</p>
<ul>
<li>
<p><strong>Model</strong> <br />
This is a snapshot of your application's state, defined as an immutable data structure.</p>
</li>
<li>
<p><strong>Message</strong> <br />
This an event representing a change (delta) in the state of your application, defined as a discriminated union.</p>
</li>
<li>
<p><strong>Command</strong> <br />
This is a carrier of instructions, that when evaluated may produce one or more messages.</p>
</li>
<li>
<p><strong>Init</strong> <br />
This is a pure function that produces the inital state of your application and, optionally, commands to process.</p>
</li>
<li>
<p><strong>Update</strong> <br />
This is a pure function that produces a new state of your application given the previous state and, optionally, new commands to process.</p>
</li>
<li>
<p><strong>View</strong> <br />
This is a pure function that produces a new UI layout/content given the current state, defined as an F# function that uses a renderer (such as React) to declaratively build a UI.</p>
</li>
<li>
<p><strong>Program</strong> <br />
This is an opaque data structure that combines all of the above plus a <code>setState</code> function to produce a view from the model.
See the <a href="program.html"><code>Program</code></a> module for more details.</p>
</li>
</ul>
<h3><a name="Installation" class="anchor" href="#Installation">Installation</a></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="shell">paket add nuget Fable.Elmish
</code></pre></td></tr></table>
<h2><a name="Concepts" class="anchor" href="#Concepts">Concepts</a></h2>
<h3><a name="Dispatch-loop" class="anchor" href="#Dispatch-loop">Dispatch loop</a></h3>
<p><img src="img/flow.svg" alt="flow" /></p>
<p>Once started, Program runs a dispatch loop, producing a new Model given the current state and an input Message.</p>
<p>See the <a href="basics.html">basics example</a> for details.</p>
<h3><a name="Parent-child-composition-and-user-interaction" class="anchor" href="#Parent-child-composition-and-user-interaction">Parent-child composition and user interaction</a></h3>
<p>Parent-child hierarchy is made explicit by wrapping model and message types of the child with those of the parent.</p>
<p>Following diagrams show interactions between components in case of a user interacting with an example web app.
Note that Elmish doesn't depend on any specific UI such as HTML rendering (it actually does not require any UI at all), and HTML is used just for explanation purposes.</p>
<p>First the UI is initialised:</p>
<p><img src="img/parent-child-1-ui-init.svg" alt="parent-child composition: UML diagram of UI initialisation" /></p>
<ol>
<li><code>program</code> requests the initial model from the parent, top-level component (<code>Main</code>)</li>
<li>Parent component requests the initial model from its child subcomponent (<code>Widget</code>)</li>
<li><code>Widget.initialModel</code> returns its initial model to the parent</li>
<li><code>Main.initialModel</code> wraps child's model and returns the top-level initial model to the program</li>
<li>Program sends the model to the parent's <code>Main.view</code></li>
<li>Parent unwraps the child's component model from its model and sends it to child's <code>Widget.view</code></li>
<li><code>Widget.view</code> returns a rendered <code>HTML</code> page</li>
<li><code>Main.view</code> embeds child's <code>HTML</code> page in its <code>HTML</code> page</li>
<li>The resulting <code>HTML</code> page is send to the user</li>
</ol>
<p>Then the user interacts with the browser:</p>
<p><img src="img/parent-child-2-user-interaction.svg" alt="parent-child composition: UML diagram of user interacting with the browser" /></p>
<ol>
<li>User clicks on the increase button</li>
<li><code>Widget.view</code> dispatches an <code>Increase</code> message</li>
<li><code>Main.view</code> has augemented the <code>dispatch</code> so the message becomes <code>WidgetMsg Increase</code> as it is sent along to <code>program</code></li>
<li><code>program</code> calls <code>Main.update</code> with this message and <code>mainModel</code></li>
<li>As the message was tagged with <code>WidgetMsg</code>, <code>Main.update</code> delegates the update to <code>Widget.update</code>, sending along the way the <code>widgetModel</code> part of <code>mainModel</code></li>
<li><code>Widget.update</code> modifies the model according to the given message, in this case <code>Increase</code>, and returns the modified <code>widgetModel</code> plus a command</li>
<li><code>Main.update</code> returns the updated <code>mainModel</code> to <code>program</code></li>
<li><code>program</code> then renders the view again passing the updated <code>mainModel</code></li>
</ol>
<p>See the <a href="parent-child.html">example</a> for details.</p>
<h3><a name="Tasks-and-side-effects" class="anchor" href="#Tasks-and-side-effects">Tasks and side-effects</a></h3>
<p>Tasks such as reading a database or making a Web API call are performed using <code>async</code> and <code>promise</code> blocks or just plain functions.
These operations may return immediately but complete (or fail) at some later time.
To feed the results back into the dispatch loop, instead of executing the operations directly, we instruct Elmish to do it for us by wrapping the instruction in a command.</p>
<h3><a name="Commands" class="anchor" href="#Commands">Commands</a></h3>
<p>Commands are carriers of instructions, which you issue from the <code>init</code> and <code>update</code> functions.
Once evaluated, a command may produce one or more new messages, mapping success or failure as instructed ahead of time.
As with any message dispatch, in the case of Parent-Child composition, child commands need to be mapped to the parent's type:</p>
<p><img src="img/commands.svg" alt="cmd" /></p>
<ol>
<li><code>Program</code> calls the <code>Main.update</code> with a message</li>
<li><code>Main.update</code> does its own update and/or delegates to <code>Child.update</code></li>
<li><code>Child.update</code> does its own update and/or delegates to <code>GrandChild.update</code></li>
<li><code>GrandChild.update</code> returns with its model and <code>Cmd</code> (of GrandChild message type)</li>
<li><code>Child.update</code> processes GrandChild's model and maps its <code>Cmd</code> into <code>Cmd</code> of Child's message type and batches it with its own <code>Cmd</code>, if any</li>
<li><code>Main.update</code> processes Child's model and maps its <code>Cmd</code> into <code>Cmd</code> of Main's message type and batches it with its own <code>Cmd</code>, if any</li>
</ol>
<p>Here we collect commands from three different levels. At the end we send all these commands to our <code>Program</code> instance to run.</p>
<p>See the <a href="cmd.html"><code>Cmd</code></a> module for ways to construct, map and batch commands.</p>
<h3><a name="Subscriptions" class="anchor" href="#Subscriptions">Subscriptions</a></h3>
<p>Most of the messages (changes in the state) will originate within your code, but some will come from the outside, for example from a timer or a websocket.
These sources can be tapped into with subscriptions, defined as F# functions that can dispatch new messages as they happen.</p>
<p>See the <a href="subscriptions.html">subscriptions example</a> for details.</p>
<h3><a name="View" class="anchor" href="#View">View</a></h3>
<p>The core is independent of any particular technolgy, instead relying on a renderer library to implement <code>setState</code> in any way seen fit.
In fact, an Elmish app can run entirely without a UI!</p>
<p>At the moment, there are two UI technologies for which rendering has been implemented: React and React Native.</p>
<p>For details please see <a href="https://elmish.github.io/react">elmish-react</a>.</p>
<h3><a name="Interacting-with-a-browser" class="anchor" href="#Interacting-with-a-browser">Interacting with a browser</a></h3>
<p>Larger Elmish applications for the browser may benefit from advanced features like routing and explicit navigation control.</p>
<p>For information about these features please see <a href="https://elmish.github.io/browser">elmish-browser</a>.</p>
<h3><a name="Observing-the-state-changes" class="anchor" href="#Observing-the-state-changes">Observing the state changes</a></h3>
<p>Every message going through the dispatch loop can be traced, along with the current state of the app.
Just augument the program instance with a trace function:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="id">Elmish</span>

<span class="id">Program</span><span class="pn">.</span><span class="id">mkSimple</span> <span class="id">init</span> <span class="id">update</span> <span class="id">view</span>
<span class="o">|&gt;</span> <span class="id">Program</span><span class="pn">.</span><span class="id">withConsoleTrace</span>
<span class="o">|&gt;</span> <span class="id">Program</span><span class="pn">.</span><span class="id">run</span>
</code></pre></td>
</tr>
</table>
<p>And start seeing the state and messages as updates happen in the browser developer console.</p>
<p>For more advanced debugging capabilities please see <a href="https://elmish.github.io/debugger">elmish-debugger</a>.</p>


        </div>
        <div class="span3">
          <img src="https://elmish.github.io/elmish/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">elmish</li>
            <li><a href="https://github.com/elmish/elmish">Source Code on GitHub</a></li>
            <li class="nav-header">Step by step</li>
            <li><a href="https://elmish.github.io/elmish/basics.html">The basics</a></li>
            <li><a href="https://elmish.github.io/elmish/parent-child.html">Parent-child</a></li>
            <li><a href="https://elmish.github.io/elmish/subscriptions.html">Subscriptions</a></li>
            <li class="nav-header">Modules</li>
            <li><a href="https://elmish.github.io/elmish/prelude.html">Prelude</a></li>
            <li><a href="https://elmish.github.io/elmish/cmd.html">Cmd</a></li>
            <li><a href="https://elmish.github.io/elmish/program.html">Program</a></li>
          </ul>
        </div>
      </div>
    </div>
  </body>
  </html>
